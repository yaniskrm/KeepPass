<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accueil - KeepPass</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined">
    <script src="script.js"></script>
</head>
<body>
    <header class="header">
        <div class="logo">KeepPass</div>
        <h2 class="tagline">Stockez vos mots de passe en toute sécurité</h2>
    </header>

    <div id="welcomeContainer" class="welcome-container">
        <div id="welcomeMessage" class="welcome-message"></div>
        <div id="loginLinkContainer" class="login-link-container" style="display: none; text-align: center;">
            <a href="../login/login.html" class="btn">Connectez-vous ou inscrivez-vous</a>
        </div>
    </div>

    <div class="settings-container">
        <span class="material-icons-outlined settings-icon" id="settingsIcon">settings</span>
        <div id="settings-menu" class="settings-menu">
            <a href="" class="settings-link">Modifier le compte</a>
            <a href="http://localhost:3001/logout" class="settings-link">Se déconnecter</a>
        </div>
    </div>

    <div class="main-sections">
        <div id="passwordGenerator" class="section">
            <a href="../generateur/generateur.html" class="btn section-link">Générateur de Mots de Passe</a>
        </div>
        <div id="passwordComparer" class="section">
            <a href="../comparateur/comparateur.html" class="btn section-link">Comparateur de Mots de Passe</a>
        </div>
        <div id="myPasswords" class="section">
            <a href="../liste/list.html" class="btn section-link">Mes Mots de Passe</a>
        </div>
    </div>

    <footer class="footer">
        <p>&copy; 2024 KeepPass. Tous droits réservés.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Vérifiez l'état de la session utilisateur
            fetch('http://localhost:3001/api/user', {
                credentials: 'include'
            })
            .then(response => {
                if (response.ok) {
                    return response.json();
                }
                throw new Error('Non authentifié');
            })
            .then(user => {
                // Utilisateur connecté
                document.getElementById('welcomeMessage').innerHTML = `Bonjour ${user.pseudo}, sélectionnez une option :`;
                document.querySelector('.main-sections').style.display = 'flex'; // Affiche les sections
                document.getElementById('welcomeContainer').style.display = 'block'; // Affiche le conteneur de bienvenue
            })
            .catch(error => {
                // Utilisateur non connecté
                document.getElementById('welcomeMessage').innerHTML = 'Bonjour, veuillez vous connecter.';
                document.getElementById('loginLinkContainer').style.display = 'block'; // Affiche le lien de connexion/inscription
                document.querySelector('.main-sections').style.display = 'none'; // Cache les sections
                document.getElementById('welcomeContainer').style.display = 'block'; // Affiche le conteneur de bienvenue
            });

            // Gérer l'ouverture/fermeture du menu des paramètres
            const settingsIcon = document.getElementById('settingsIcon');
            const settingsMenu = document.getElementById('settings-menu');

            settingsIcon.addEventListener('click', function(event) {
                settingsMenu.style.display = (settingsMenu.style.display === 'block') ? 'none' : 'block';
                event.stopPropagation();
            });

            // Fermer le menu si on clique en dehors
            document.addEventListener('click', function(event) {
                if (!settingsMenu.contains(event.target) && !settingsIcon.contains(event.target)) {
                    settingsMenu.style.display = 'none';
                }
            });

            // Rend chaque section cliquable
            const clickableSections = document.querySelectorAll('.section');
            
            clickableSections.forEach(section => {
                section.addEventListener('click', function() {
                    const link = section.querySelector('.section-link');
                    if (link) {
                        window.location.href = link.href; // Redirige vers l'URL du lien
                    }
                });
            });
        });
    </script>
</body>
</html>
