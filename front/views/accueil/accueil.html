<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accueil - KeepPass</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined">
    <script src="script.js"></script>
</head>
<body>
    <header class="header">
        <div class="logo">KeepPass</div>
        <h2 class="tagline">Stockez vos mots de passe en toute sécurité</h2>
    </header>
    

    <div id="welcomeMessage" class="welcome-message"></div>
    <div class="settings-container">
        <span class="material-icons-outlined settings-icon" id="settingsIcon">settings</span>
        <div id="settings-menu" class="settings-menu">
            <a href="" class="settings-link">Modifier le compte</a>
            <a href="http://localhost:3001/logout" class="settings-link">Se déconnecter</a>
        </div>
    </div>

    <div id="loginLinkContainer" class="login-link-container" style="display: none; text-align: center;">
        <a href="../login/login.html" class="btn">Connectez-vous ou inscrivez-vous</a>
    </div>
    

    <div class="main-nav">
        <a href="../generateur/generateur.html" class="btn">Générateur de Mots de Passe</a>
        <a href="../comparateur/comparateur.html" class="btn">Comparateur de Mots de Passe</a>
        <a href="" class="btn">Mes Mots de Passe</a>
    </div>

    <footer class="footer">
        <p>&copy; 2024 KeepPass. Tous droits réservés.</p>
    </footer>
    <script>
        
        fetch('http://localhost:3001/api/user', {
            credentials: 'include'
        })
        .then(response => {
            if (response.ok) {
                return response.json();
            }
            throw new Error('Non authentifié');
        })
        .then(user => {
            // Modification ici pour n'inclure que le pseudo de l'utilisateur dans le message
            document.getElementById('welcomeMessage').innerHTML = `Bonjour ${user.pseudo}, sélectionnez une option :`;
        })
        .catch(error => {
            document.getElementById('welcomeMessage').innerHTML = 'Bonjour, veuillez vous connecter ';
        });
        document.addEventListener('DOMContentLoaded', function() {
        const settingsIcon = document.getElementById('settingsIcon');
        const settingsMenu = document.getElementById('settings-menu');

        // Gérer l'ouverture/fermeture du menu des paramètres
        settingsIcon.addEventListener('click', function(event) {
            // Toggle la visibilité du menu
            settingsMenu.style.display = (settingsMenu.style.display === 'block') ? 'none' : 'block';
            event.stopPropagation(); // Empêche le clic de se propager plus loin
        });

        // Fermer le menu si on clique en dehors
        document.addEventListener('click', function(event) {
            if (!settingsMenu.contains(event.target) && !settingsIcon.contains(event.target)) {
                settingsMenu.style.display = 'none';
            }
        });
        });

        fetch('http://localhost:3001/api/user', {
            credentials: 'include'
        })
        .then(response => {
            if (response.ok) {
                return response.json();
            }
            throw new Error('Non authentifié');
        })
        .then(user => {
            // Utilisateur connecté
            document.getElementById('welcomeMessage').innerHTML = `Bonjour ${user.pseudo}, sélectionnez une option :`;
            document.querySelector('.main-nav').style.display = 'block'; // Affiche la navigation
        })
        .catch(error => {
            // Utilisateur non connecté
            document.getElementById('welcomeMessage').innerHTML = 'Bonjour, veuillez vous connecter.';
            document.getElementById('loginLinkContainer').style.display = 'block'; // Affiche le lien de connexion/inscription
        });

        // Gestion du menu des paramètres...
        document.addEventListener('DOMContentLoaded', function() {
            const settingsIcon = document.getElementById('settingsIcon');
            const settingsMenu = document.getElementById('settings-menu');
            settingsIcon.addEventListener('click', function(event) {
                settingsMenu.style.display = (settingsMenu.style.display === 'block') ? 'none' : 'block';
                event.stopPropagation();
            });

            document.addEventListener('click', function(event) {
                if (!settingsMenu.contains(event.target) && !settingsIcon.contains(event.target)) {
                    settingsMenu.style.display = 'none';
                }
            });
        });

    </script>
</body>
</html>